<UserControl x:Class="MGK_Analyzer.Controls.MdiContourWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MGK_Analyzer.Controls"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000"
             Width="1000" Height="700"
             Loaded="MdiContourWindow_Loaded">

    <UserControl.Resources>
        <Storyboard x:Key="SlideInStoryboard">
            <DoubleAnimation Storyboard.TargetName="ManagementPanel"
                           Storyboard.TargetProperty="Width"
                           From="0" To="280" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        <Storyboard x:Key="SlideOutStoryboard">
            <DoubleAnimation Storyboard.TargetName="ManagementPanel"
                           Storyboard.TargetProperty="Width"
                           From="280" To="0" Duration="0:0:0.15">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>

    <Border Background="White" BorderBrush="Gray" BorderThickness="1" CornerRadius="5">
        <!-- Context Menu for Right-click resize options -->
        <Border.ContextMenu>
            <ContextMenu FontFamily="Malgun Gothic">
                <MenuItem Header="Size Settings" FontWeight="Bold" IsEnabled="False"/>
                <Separator/>
                <MenuItem Header="Small (400 x 300)" Click="SetSmallSize_Click"/>
                <MenuItem Header="Medium (800 x 600)" Click="SetMediumSize_Click"/>
                <MenuItem Header="Large (1200 x 800)" Click="SetLargeSize_Click"/>
                <MenuItem Header="HD (Max)" Click="SetHDSize_Click"/>
                <Separator/>
                <MenuItem Header="Custom..." Click="ShowCustomSizeDialog_Click"/>
                <Separator/>
                <MenuItem Header="Maximize" Click="Maximize_Click"/>
                <MenuItem Header="Minimize" Click="Minimize_Click"/>
            </ContextMenu>
        </Border.ContextMenu>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

                <!-- Title Bar -->
                <Border Grid.Row="0" Background="SteelBlue" CornerRadius="5,5,0,0"
                        MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid>
                        <TextBlock Text="{Binding WindowTitle, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  Foreground="White" VerticalAlignment="Center" Margin="10,0"
                                  FontWeight="SemiBold" FontFamily="Malgun Gothic"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                            <Button Content="-" Width="25" Height="20" Click="Minimize_Click"
                                    Background="Transparent" BorderBrush="White" Foreground="White"
                                    Margin="1" FontFamily="Malgun Gothic"/>
                            <Button Content="Max" Width="25" Height="20" Click="Maximize_Click"
                                    Background="Transparent" BorderBrush="White" Foreground="White"
                                    Margin="1" FontFamily="Malgun Gothic"/>
                            <Button Content="X" Width="25" Height="20" Click="Close_Click"
                                    Background="Transparent" BorderBrush="White" Foreground="White"
                                    Margin="1" FontFamily="Malgun Gothic"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Grid Grid.Row="1" Background="White">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" BorderBrush="#FFCCCCCC" BorderThickness="1" Margin="5">
                        <syncfusion:SfSurfaceChart x:Name="ContourChart" 
                                                  Type="Contour"
                                                  Rotate="0"
                                                  Margin="10"
                                                  XBindingPath="X"
                                                  YBindingPath="Y"
                                                  ZBindingPath="Z">
                            <syncfusion:SfSurfaceChart.ColorBar>
                                <syncfusion:ChartColorBar ShowLabel="True" DockPosition="Right"/>
                            </syncfusion:SfSurfaceChart.ColorBar>
                        </syncfusion:SfSurfaceChart>
                    </Border>

                    <Grid Grid.Column="1" x:Name="ManagementPanelContainer">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" x:Name="ManagementPanelTab"
                                Background="#FF2D2D30" 
                                BorderBrush="#FF3E3E42" 
                                BorderThickness="1,0,0,0"
                                Cursor="Hand"
                                MouseEnter="ManagementPanelTab_MouseEnter"
                                MouseDown="ManagementPanelTab_MouseDown"
                                Visibility="Collapsed">
                            <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                                <TextBlock Text="S" FontSize="9" Foreground="White" FontWeight="Bold" HorizontalAlignment="Center" Margin="1"/>
                                <TextBlock Text="E" FontSize="8" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,1"/>
                                <TextBlock Text="T" FontSize="8" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,1"/>
                                <TextBlock Text="T" FontSize="8" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,1"/>
                                <TextBlock Text="I" FontSize="8" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,1"/>
                                <TextBlock Text="N" FontSize="8" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,1"/>
                                <TextBlock Text="G" FontSize="8" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,1"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" x:Name="ManagementPanel"
                                Width="280"
                                Background="#FFF5F5F5"
                                BorderBrush="#FFCCCCCC" 
                                BorderThickness="1,0,0,0"
                                MouseLeave="ManagementPanel_MouseLeave">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="10">
                                    <Grid Margin="0,0,0,10">
                                        <TextBlock Text="Contour Settings" 
                                                   FontSize="14" FontWeight="SemiBold"/>
                                        <ToggleButton x:Name="PanelPinButton"
                                                      HorizontalAlignment="Right"
                                                      Width="24" Height="20"
                                                      Checked="PanelPinButton_Checked"
                                                      Unchecked="PanelPinButton_Unchecked"
                                                      ToolTip="Pin/Unpin">
                                            <Path Data="{StaticResource PinIcon}" 
                                                  Width="12" Height="12" 
                                                  Fill="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton}, Path=Foreground}"
                                                  Stretch="Uniform"/>
                                        </ToggleButton>
                                    </Grid>

                                    <GroupBox Header="Color Palette" Margin="0,5">
                                        <StackPanel>
                                            <ComboBox x:Name="ColorPaletteComboBox" 
                                                     SelectionChanged="ColorPalette_SelectionChanged"
                                                     Margin="5">
                                                <ComboBoxItem Content="Rainbow" IsSelected="True"/>
                                                <ComboBoxItem Content="Jet"/>
                                                <ComboBoxItem Content="Hot"/>
                                                <ComboBoxItem Content="Cool"/>
                                                <ComboBoxItem Content="Grayscale"/>
                                            </ComboBox>
                                        </StackPanel>
                                    </GroupBox>

                                    <GroupBox Header="Contour Levels" Margin="0,10,0,5">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="5">
                                                <TextBlock Text="Number of Levels: " VerticalAlignment="Center"/>
                                                <TextBox x:Name="ContourLevelsTextBox" 
                                                        Text="10" Width="50" Margin="5,0"
                                                        TextChanged="ContourLevels_TextChanged"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </GroupBox>

                                    <GroupBox Header="Display Options" Margin="0,10,0,5">
                                        <StackPanel>
                                            <CheckBox x:Name="ShowLabelsCheckBox" 
                                                     Content="Show Labels" 
                                                     IsChecked="True"
                                                     Checked="ShowLabels_Changed"
                                                     Unchecked="ShowLabels_Changed"
                                                     Margin="5"/>
                                            <CheckBox x:Name="ShowLegendCheckBox" 
                                                     Content="Show Legend" 
                                                     IsChecked="True"
                                                     Checked="ShowLegend_Changed"
                                                     Unchecked="ShowLegend_Changed"
                                                     Margin="5"/>
                                        </StackPanel>
                                    </GroupBox>

                                    <GroupBox Header="Export" Margin="0,10,0,5">
                                        <StackPanel>
                                            <Button Content="Export Chart" 
                                                   Click="ExportChart_Click"
                                                   Margin="5" Padding="10,5"/>
                                            <Button Content="Reset View" 
                                                   Click="ResetView_Click"
                                                   Margin="5" Padding="10,5"/>
                                        </StackPanel>
                                    </GroupBox>

                                    <GroupBox Header="Data Information" Margin="0,10,0,5">
                                        <StackPanel>
                                            <TextBlock x:Name="DataPointsCountText" 
                                                      Text="Data Points: 0" 
                                                      Margin="5"/>
                                            <TextBlock x:Name="ValueRangeText" 
                                                      Text="Value Range: -" 
                                                      Margin="5"/>
                                        </StackPanel>
                                    </GroupBox>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>

                </Grid>

            <!-- Resize Handles - All directions resizable (match 3D surface window) -->
            <!-- Top Edge -->
            <Rectangle Height="5" Fill="Transparent" 
                      HorizontalAlignment="Stretch" VerticalAlignment="Top"
                      Cursor="SizeNS" MouseLeftButtonDown="ResizeTop_MouseLeftButtonDown"
                      Margin="5,0,5,0" Grid.RowSpan="2" Panel.ZIndex="2000"/>

            <!-- Bottom Edge -->
            <Rectangle Height="5" Fill="Transparent" 
                      HorizontalAlignment="Stretch" VerticalAlignment="Bottom"
                      Cursor="SizeNS" MouseLeftButtonDown="ResizeBottom_MouseLeftButtonDown"
                      Margin="5,0,5,0" Grid.RowSpan="2" Panel.ZIndex="2000"/>

            <!-- Left Edge -->
            <Rectangle Width="5" Fill="Transparent" 
                      HorizontalAlignment="Left" VerticalAlignment="Stretch"
                      Cursor="SizeWE" MouseLeftButtonDown="ResizeLeft_MouseLeftButtonDown"
                      Margin="0,5,0,5" Grid.RowSpan="2" Panel.ZIndex="2000"/>

            <!-- Right Edge -->
            <Rectangle Width="5" Fill="Transparent" 
                      HorizontalAlignment="Right" VerticalAlignment="Stretch"
                      Cursor="SizeWE" MouseLeftButtonDown="ResizeRight_MouseLeftButtonDown"
                      Margin="0,5,0,5" Grid.RowSpan="2" Panel.ZIndex="2000"/>

            <!-- Corner Handles (invisible) -->
            <Rectangle Width="10" Height="10" Fill="Transparent" 
                      HorizontalAlignment="Left" VerticalAlignment="Top"
                      Cursor="SizeNWSE" MouseLeftButtonDown="ResizeTopLeft_MouseLeftButtonDown"
                      Grid.RowSpan="2" Panel.ZIndex="2000"/>

            <Rectangle Width="10" Height="10" Fill="Transparent" 
                      HorizontalAlignment="Right" VerticalAlignment="Top"
                      Cursor="SizeNESW" MouseLeftButtonDown="ResizeTopRight_MouseLeftButtonDown"
                      Grid.RowSpan="2" Panel.ZIndex="2000"/>

            <Rectangle Width="10" Height="10" Fill="Transparent" 
                      HorizontalAlignment="Left" VerticalAlignment="Bottom"
                      Cursor="SizeNESW" MouseLeftButtonDown="ResizeBottomLeft_MouseLeftButtonDown"
                      Grid.RowSpan="2" Panel.ZIndex="2000"/>

            <Rectangle Width="15" Height="15" Fill="Transparent" 
                      HorizontalAlignment="Right" VerticalAlignment="Bottom"
                      Cursor="SizeNWSE" MouseLeftButtonDown="ResizeBottomRight_MouseLeftButtonDown"
                      Grid.RowSpan="2" Panel.ZIndex="2000"/>
        </Grid>
    </Border>
</UserControl>
