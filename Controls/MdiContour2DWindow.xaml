<UserControl x:Class="MGK_Analyzer.Controls.MdiContour2DWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:oxy="http://oxyplot.org/wpf"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             mc:Ignorable="d" 
             Width="1000" Height="700"
             FontFamily="Malgun Gothic">
    
    <UserControl.Resources>
        <DropShadowEffect x:Key="WindowShadow" ShadowDepth="3" BlurRadius="10" Opacity="0.3"/>
        
        <!-- Panel Slide Animations -->
        <Storyboard x:Key="PanelSlideInStoryboard">
            <DoubleAnimation Storyboard.TargetName="ManagementPanel"
                           Storyboard.TargetProperty="Width"
                           From="0" To="250" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        <Storyboard x:Key="PanelSlideOutStoryboard">
            <DoubleAnimation Storyboard.TargetName="ManagementPanel"
                           Storyboard.TargetProperty="Width"
                           From="250" To="0" Duration="0:0:0.15">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>
    
    <Border Background="White" BorderBrush="Gray" BorderThickness="1"
            CornerRadius="5" Effect="{StaticResource WindowShadow}">
        
        <Border.ContextMenu>
            <ContextMenu FontFamily="Malgun Gothic">
                <MenuItem Header="Size Settings" FontWeight="Bold" IsEnabled="False"/>
                <Separator/>
                <MenuItem Header="Small (400 x 300)" Click="SetSmallSize_Click"/>
                <MenuItem Header="Medium (800 x 600)" Click="SetMediumSize_Click"/>
                <MenuItem Header="Large (1200 x 800)" Click="SetLargeSize_Click"/>
                <MenuItem Header="HD (Max)" Click="SetHDSize_Click"/>
                <Separator/>
                <MenuItem Header="Custom..." Click="ShowCustomSizeDialog_Click"/>
                <Separator/>
                <MenuItem Header="Maximize" Click="Maximize_Click"/>
                <MenuItem Header="Minimize" Click="Minimize_Click"/>
            </ContextMenu>
        </Border.ContextMenu>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Title Bar -->
            <Border Grid.Row="0" Background="SteelBlue" CornerRadius="5,5,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <TextBlock Text="{Binding WindowTitle, RelativeSource={RelativeSource AncestorType=UserControl}}"
                              Foreground="White" VerticalAlignment="Center" Margin="10,0"
                              FontWeight="SemiBold" FontFamily="Malgun Gothic"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                        <Button Content="-" Width="25" Height="20" Click="Minimize_Click"
                                Background="Transparent" BorderBrush="White" Foreground="White"
                                Margin="1" FontFamily="Malgun Gothic"/>
                        <Button Content="Max" Width="25" Height="20" Click="Maximize_Click"
                                Background="Transparent" BorderBrush="White" Foreground="White"
                                Margin="1" FontFamily="Malgun Gothic"/>
                        <Button Content="X" Width="25" Height="20" Click="Close_Click"
                                Background="Transparent" BorderBrush="White" Foreground="White"
                                Margin="1" FontFamily="Malgun Gothic"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Content Area -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- OxyPlot Surface Chart (Contour/Surface) -->
                <oxy:PlotView Grid.Column="0" x:Name="PlotView1"
                              Margin="5" Background="Transparent">
                </oxy:PlotView>
                
                <!-- Management Panel Container -->
                <Border Grid.Column="1" x:Name="ManagementPanelContainer" ClipToBounds="True">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="25"/>
                        </Grid.ColumnDefinitions>

                        <!-- Management Panel -->
                        <Border Grid.Column="0" x:Name="ManagementPanel"
                                Width="250" Background="WhiteSmoke" 
                                BorderBrush="LightGray" BorderThickness="1,0,0,0"
                                MouseLeave="ManagementPanel_MouseLeave">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Panel Header -->
                                <Border Grid.Row="0" Background="#FFE8E8E8" 
                                        BorderBrush="#FFCCCCCC" BorderThickness="0,0,0,1"
                                        Height="30">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Grid.Column="0" Text="Contour Management" 
                                                   FontSize="12" FontWeight="SemiBold"
                                                   VerticalAlignment="Center" Margin="8,0"
                                                   FontFamily="Malgun Gothic"/>
                                        
                                        <!-- Pin Button -->
                                        <ToggleButton Grid.Column="1" x:Name="PanelPinButton"
                                                      Width="24" Height="20" Margin="5"
                                                      Checked="PanelPinButton_Checked"
                                                      Unchecked="PanelPinButton_Unchecked"
                                                      ToolTip="Pin/Unpin">
                                            <TextBlock Text="PIN" FontSize="8"/>
                                        </ToggleButton>
                                    </Grid>
                                </Border>

                                <!-- Panel Content -->
                                <TabControl Grid.Row="1" Background="Transparent" 
                                           BorderThickness="0" Margin="5">
                                    <!-- Levels Tab -->
                                    <TabItem Header="Levels" FontFamily="Malgun Gothic" FontSize="11">
                                        <StackPanel Margin="5" Orientation="Vertical" >
                                            <TextBlock Text="Efficiency Color Settings" FontWeight="Bold" Margin="0,0,0,6"/>

                                            <!-- Palette theme slider -->
                                            <TextBlock Text="Palette Theme" Margin="0,8,0,2"/>
                                            <Slider x:Name="PaletteThemeSlider" Minimum="0" Maximum="3" Value="0"
                                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                                    ValueChanged="PaletteThemeSlider_OnValueChanged"/>
                                            <TextBlock FontSize="10" Foreground="#666" Margin="0,2,0,10"
                                                       Text="0: Default | 1: Viridis | 2: Hot | 3: Cool"/>

                                            <!-- Palette intensity slider -->
                                            <TextBlock Text="Color Intensity" Margin="0,8,0,2"/>
                                            <Slider x:Name="PaletteIntensitySlider" Minimum="0" Maximum="100" Value="100"
                                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                                    ValueChanged="PaletteIntensitySlider_OnValueChanged"/>
                                            <TextBlock FontSize="10" Foreground="#666" Margin="0,2,0,0"
                                                       Text="0%: Grayscale -> 100%: Original"/>
                                        </StackPanel>
                                    </TabItem>
                                    
                                    <!-- Properties Tab -->
                                    <TabItem Header="Properties" FontFamily="Malgun Gothic" FontSize="11">
                                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                                            <StackPanel Margin="5">
                                                <TextBlock Text="Chart Properties" FontWeight="Bold" 
                                                          FontFamily="Malgun Gothic" Margin="0,0,0,10"/>
                                                
                                                <TextBlock Text="Title:" FontSize="10" 
                                                          FontFamily="Malgun Gothic" Margin="0,5,0,2"/>
                                                <TextBox Text="{Binding WindowTitle, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        FontFamily="Malgun Gothic" Padding="3"/>
                                                
                                                <!-- Size controls -->
                                                <TextBlock Text="Chart Size" FontWeight="Bold" 
                                                          FontFamily="Malgun Gothic" Margin="0,15,0,5"/>
                                                
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    
                                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Width:" FontSize="10" 
                                                              VerticalAlignment="Center" Margin="0,0,5,0"/>
                                                    <TextBox Grid.Row="0" Grid.Column="1" x:Name="WidthTextBox"
                                                            Text="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat=F0, Mode=OneWay}"
                                                            FontFamily="Malgun Gothic" Padding="3" Margin="0,0,10,5"/>
                                                    
                                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Height:" FontSize="10" 
                                                              VerticalAlignment="Center" Margin="0,0,5,0"/>
                                                    <TextBox Grid.Row="0" Grid.Column="3" x:Name="HeightTextBox"
                                                            Text="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat=F0, Mode=OneWay}"
                                                            FontFamily="Malgun Gothic" Padding="3" Margin="0,0,0,5"/>
                                                </Grid>
                                                <StackPanel Orientation="Horizontal" Margin="0,5">
                                                    <Button Content="Apply Size" Click="ApplySize_Click"
                                                           FontFamily="Malgun Gothic" Padding="5" Margin="0,0,5,0"/>
                                                    <Button Content="Reset Size" Click="ResetSize_Click"
                                                           FontFamily="Malgun Gothic" Padding="5"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </ScrollViewer>
                                    </TabItem>
                                </TabControl>
                            </Grid>
                        </Border>

                        <!-- Collapsed Tab Button -->
                        <Border Grid.Column="1" x:Name="ManagementPanelTab"
                                Background="#FF2D2D30" 
                                BorderBrush="#FF3E3E42" BorderThickness="1,0,0,0"
                                Cursor="Hand" Visibility="Collapsed"
                                MouseEnter="ManagementPanelTab_MouseEnter"
                                MouseDown="ManagementPanelTab_MouseDown">
                            <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                                <TextBlock Text="D" FontSize="10" Foreground="White" FontWeight="Bold"
                                           HorizontalAlignment="Center" Margin="1" FontFamily="Malgun Gothic"/>
                                <TextBlock Text="A" FontSize="8" Foreground="#FFAAAAAA" 
                                           HorizontalAlignment="Center" Margin="0,1" FontFamily="Malgun Gothic"/>
                                <TextBlock Text="T" FontSize="8" Foreground="#FFAAAAAA" 
                                           HorizontalAlignment="Center" Margin="0,1" FontFamily="Malgun Gothic"/>
                                <TextBlock Text="A" FontSize="8" Foreground="#FFAAAAAA" 
                                           HorizontalAlignment="Center" Margin="0,1" FontFamily="Malgun Gothic"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Resize Handles (same as MdiChartWindow) -->
            <Rectangle Height="5" Fill="Transparent" 
                      HorizontalAlignment="Stretch" VerticalAlignment="Top"
                      Cursor="SizeNS" MouseLeftButtonDown="ResizeTop_MouseLeftButtonDown"
                      Margin="5,0,5,0" ToolTip="Drag top edge to resize height"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
            <Rectangle Height="5" Fill="Transparent" 
                      HorizontalAlignment="Stretch" VerticalAlignment="Bottom"
                      Cursor="SizeNS" MouseLeftButtonDown="ResizeBottom_MouseLeftButtonDown"
                      Margin="5,0,5,0" ToolTip="Drag bottom edge to resize height"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
            <Rectangle Width="5" Fill="Transparent" 
                      HorizontalAlignment="Left" VerticalAlignment="Stretch"
                      Cursor="SizeWE" MouseLeftButtonDown="ResizeLeft_MouseLeftButtonDown"
                      Margin="0,5,0,5" ToolTip="Drag left edge to resize width"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
            <Rectangle Width="5" Fill="Transparent" 
                      HorizontalAlignment="Right" VerticalAlignment="Stretch"
                      Cursor="SizeWE" MouseLeftButtonDown="ResizeRight_MouseLeftButtonDown"
                      Margin="0,5,0,5" ToolTip="Drag right edge to resize width"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
            <Rectangle Width="10" Height="10" Fill="DarkGray" 
                      HorizontalAlignment="Left" VerticalAlignment="Top"
                      Cursor="SizeNWSE" MouseLeftButtonDown="ResizeTopLeft_MouseLeftButtonDown"
                      Margin="0,0,0,0" ToolTip="Drag corner to resize"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
            <Rectangle Width="10" Height="10" Fill="DarkGray" 
                      HorizontalAlignment="Right" VerticalAlignment="Top"
                      Cursor="SizeNESW" MouseLeftButtonDown="ResizeTopRight_MouseLeftButtonDown"
                      Margin="0,0,0,0" ToolTip="Drag corner to resize"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
            <Rectangle Width="10" Height="10" Fill="DarkGray" 
                      HorizontalAlignment="Left" VerticalAlignment="Bottom"
                      Cursor="SizeNESW" MouseLeftButtonDown="ResizeBottomLeft_MouseLeftButtonDown"
                      Margin="0,0,0,0" ToolTip="Drag corner to resize"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
            <Rectangle Width="15" Height="15" Fill="Gray" 
                      HorizontalAlignment="Right" VerticalAlignment="Bottom"
                      Cursor="SizeNWSE" MouseLeftButtonDown="ResizeBottomRight_MouseLeftButtonDown"
                      Margin="0,0,0,0" ToolTip="Drag corner to resize"
                      Grid.RowSpan="2" Panel.ZIndex="1000"/>
        </Grid>
    </Border>
</UserControl>
