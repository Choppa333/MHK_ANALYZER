<UserControl x:Class="MGK_Analyzer.Controls.MdiSurface3DWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:syncfusion="clr-namespace:Syncfusion.UI.Xaml.Charts;assembly=Syncfusion.SfChart.WPF"
             mc:Ignorable="d"
             Width="1000" Height="700"
             FontFamily="Malgun Gothic">
    <Border Background="White" BorderBrush="Gray" BorderThickness="1" CornerRadius="5">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0" Background="SteelBlue" CornerRadius="5,5,0,0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <TextBlock Text="{Binding WindowTitle, RelativeSource={RelativeSource AncestorType=UserControl}}" Foreground="White" VerticalAlignment="Center" Margin="10,0" FontWeight="SemiBold"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
                        <Button Content="-" Width="25" Height="20" Click="Minimize_Click" Background="Transparent" BorderBrush="White" Foreground="White" Margin="1"/>
                        <Button Content="Max" Width="25" Height="20" Click="Maximize_Click" Background="Transparent" BorderBrush="White" Foreground="White" Margin="1"/>
                        <Button Content="X" Width="25" Height="20" Click="Close_Click" Background="Transparent" BorderBrush="White" Foreground="White" Margin="1"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Content Area -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Toolbar -->
                <ToolBarTray Grid.Row="0">
                    <ToolBar>
                        <TextBlock Text="Tilt" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <Slider x:Name="SldTilt" Width="120" Minimum="-60" Maximum="60" Value="15" TickFrequency="5" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="Rotate" Margin="10,0,6,0" VerticalAlignment="Center"/>
                        <Slider x:Name="SldRotate" Width="140" Minimum="-180" Maximum="180" Value="30" TickFrequency="10" IsSnapToTickEnabled="True"/>
                        <Separator/>
                        <TextBlock Text="Levels" Margin="10,0,6,0" VerticalAlignment="Center"/>
                        <Slider x:Name="SldLevels" Width="110" Minimum="5" Maximum="32" Value="16" TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="Opacity" Margin="10,0,6,0" VerticalAlignment="Center"/>
                        <Slider x:Name="SldOpacity" Width="110" Minimum="0.2" Maximum="1.0" Value="1.0" TickFrequency="0.1"/>
                        <Separator/>
                        <TextBlock Text="Palette" Margin="10,0,6,0" VerticalAlignment="Center"/>
                        <ComboBox x:Name="CmbPalette" Width="160" SelectedIndex="0">
                            <ComboBoxItem Content="Metro"/>
                            <ComboBoxItem Content="BlueChrome"/>
                            <ComboBoxItem Content="GreenChrome"/>
                            <ComboBoxItem Content="Custom (Blue-Yellow-Red)"/>
                        </ComboBox>
                        <Separator/>
                        <Button x:Name="BtnResetView" Content="Reset View" Padding="8,2"/>
                    </ToolBar>
                </ToolBarTray>

                <!-- Chart -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="110"/>
                    </Grid.ColumnDefinitions>

                    <syncfusion:SfSurfaceChart x:Name="SurfaceChart"
                                              Grid.Column="0"
                                              Type="Surface"
                                              Tilt="15" Rotate="30"
                                              FontSize="12"
                                              Header="3D Efficiency Map (X=Speed, Y=Efficiency, Z=Torque)">
                        <syncfusion:SfSurfaceChart.XAxis>
                            <syncfusion:SurfaceAxis Header="[X] Speed [rpm]" LabelFormat="#####"/>
                        </syncfusion:SfSurfaceChart.XAxis>
                        <syncfusion:SfSurfaceChart.YAxis>
                            <syncfusion:SurfaceAxis Header="[Y] Efficiency [%]" LabelFormat="0.0"/>
                        </syncfusion:SfSurfaceChart.YAxis>
                        <syncfusion:SfSurfaceChart.ZAxis>
                            <syncfusion:SurfaceAxis Header="[Z] Torque [Nm]" LabelFormat="0.#"/>
                        </syncfusion:SfSurfaceChart.ZAxis>
                    </syncfusion:SfSurfaceChart>

                    <!-- Custom Z-based legend -->
                    <Border Grid.Column="1" Margin="6" Padding="4" Background="White" BorderBrush="#DDD" BorderThickness="1">
                        <StackPanel Orientation="Vertical">
                            <TextBlock Text="[Y] Efficiency [%]" FontWeight="Bold" Margin="0,0,0,6" Foreground="#333" FontSize="11"/>
                            <ItemsControl x:Name="ZLegend">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <Rectangle Width="14" Height="14" Fill="{Binding Brush}" Stroke="#888" StrokeThickness="0.5"/>
                                            <TextBlock Text="{Binding Label}" Margin="8,0,0,0" VerticalAlignment="Center" FontSize="10"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>

            <!-- Resize Handles -->
            <Rectangle Height="5" Fill="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Top" Cursor="SizeNS" MouseLeftButtonDown="ResizeTop_MouseLeftButtonDown" Grid.RowSpan="2"/>
            <Rectangle Height="5" Fill="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Cursor="SizeNS" MouseLeftButtonDown="ResizeBottom_MouseLeftButtonDown" Grid.RowSpan="2"/>
            <Rectangle Width="5" Fill="Transparent" HorizontalAlignment="Left" VerticalAlignment="Stretch" Cursor="SizeWE" MouseLeftButtonDown="ResizeLeft_MouseLeftButtonDown" Grid.RowSpan="2"/>
            <Rectangle Width="5" Fill="Transparent" HorizontalAlignment="Right" VerticalAlignment="Stretch" Cursor="SizeWE" MouseLeftButtonDown="ResizeRight_MouseLeftButtonDown" Grid.RowSpan="2"/>
            <Rectangle Width="10" Height="10" Fill="DarkGray" HorizontalAlignment="Left" VerticalAlignment="Top" Cursor="SizeNWSE" MouseLeftButtonDown="ResizeTopLeft_MouseLeftButtonDown" Grid.RowSpan="2"/>
            <Rectangle Width="10" Height="10" Fill="DarkGray" HorizontalAlignment="Right" VerticalAlignment="Top" Cursor="SizeNESW" MouseLeftButtonDown="ResizeTopRight_MouseLeftButtonDown" Grid.RowSpan="2"/>
            <Rectangle Width="10" Height="10" Fill="DarkGray" HorizontalAlignment="Left" VerticalAlignment="Bottom" Cursor="SizeNESW" MouseLeftButtonDown="ResizeBottomLeft_MouseLeftButtonDown" Grid.RowSpan="2"/>
            <Rectangle Width="15" Height="15" Fill="Gray" HorizontalAlignment="Right" VerticalAlignment="Bottom" Cursor="SizeNWSE" MouseLeftButtonDown="ResizeBottomRight_MouseLeftButtonDown" Grid.RowSpan="2"/>
        </Grid>
    </Border>
</UserControl>